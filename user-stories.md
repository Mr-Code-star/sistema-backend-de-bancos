### EPICS

| Epic ID | Epic                                     |
| ------- | ---------------------------------------- |
| EP-01   | Gestión de Identidad y Seguridad (IAM)   |
| EP-02   | Gestión de Perfil del Cliente            |
| EP-03   | Gestión de Cuentas Bancarias             |
| EP-04   | Transferencias Bancarias                 |
| EP-05   | Pagos a Servicios (Payments & Merchants) |
| EP-06   | Registro Contable (Ledger)               |
| EP-07   | Estados de Cuenta y Reportes             |
| EP-08   | Notificaciones al Usuario                |
| EP-09   | Control de Límites Operativos            |
| EP-10   | Administración y Compliance              |


### User Stories

#### IAM


| ID | Título                     | Descripción                                                         | Criterio de Aceptación                                                                                                                                                     | Relación (Epic ID) |
| ------------------ | -------------------------- | ------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------ |
| **US-IAM-01** | API RESTful – Registro de usuario                  | Como usuario quiero registrarme en la plataforma para poder acceder al sistema bancario.     | **Escenario: Registro de usuario**.<br>**Cuando** envío `POST /api/v1/iam/auth/register` con<br>`json`<br>{<br> "email": "[user@mail.com](mailto:user@mail.com)",<br> "password": "Password123!"<br>}<br>**Entonces** el sistema valida los datos, registra al usuario y devuelve `201 Created` con<br>`json`<br>{<br> "userId": "uuid",<br> "email": "[user@mail.com](mailto:user@mail.com)",<br> "status": "ACTIVE"<br>} | EP-01 |
| **US-IAM-02** | API RESTful – Login de usuario                     | Como usuario quiero autenticarme para obtener un token JWT y acceder a endpoints protegidos. | **Escenario: Login exitoso**.<br>**Cuando** envío `POST /api/v1/iam/auth/login` con<br>`json`<br>{<br> "email": "[user@mail.com](mailto:user@mail.com)",<br> "password": "Password123!"<br>}<br>**Entonces** el sistema valida las credenciales y devuelve `200 OK` con<br>`json`<br>{<br> "userId": "uuid",<br> "email": "[user@mail.com](mailto:user@mail.com)",<br> "token": "jwt-token"<br>}                           | EP-01 |
| **US-IAM-03** | API RESTful – Login con MFA                        | Como usuario quiero autenticarme usando MFA para aumentar la seguridad de mi cuenta.         | **Escenario: Login con MFA**.<br>**Dado que** el usuario tiene MFA habilitado.<br>**Cuando** envío `POST /api/v1/iam/auth/login` con<br>`json`<br>{<br> "email": "[user@mail.com](mailto:user@mail.com)",<br> "password": "Password123!",<br> "mfaCode": "123456"<br>}<br>**Entonces** el sistema valida el código MFA y devuelve `200 OK` con un token JWT válido.                                                        | EP-01 |
| **US-IAM-04** | API RESTful – Solicitar recuperación de contraseña | Como usuario quiero solicitar la recuperación de mi contraseña mediante correo electrónico.  | **Escenario: Solicitud de recuperación**.<br>**Cuando** envío `POST /api/v1/iam/password-recovery/request` con<br>`json`<br>{<br> "email": "[user@mail.com](mailto:user@mail.com)"<br>}<br>**Entonces** el sistema responde `200 OK` y, si el usuario existe, envía un correo con un enlace de recuperación.                                                                                                               | EP-01 |
| **US-IAM-05** | API RESTful – Restablecer contraseña               | Como usuario quiero cambiar mi contraseña usando un token de recuperación.                   | **Escenario: Reset de contraseña**.<br>**Dado que** el usuario posee un token válido.<br>**Cuando** envío `POST /api/v1/iam/password-recovery/reset` con<br>`json`<br>{<br> "token": "reset-token",<br> "newPassword": "NewPassword123!"<br>}<br>**Entonces** el sistema actualiza la contraseña y devuelve `200 OK` con<br>`json`<br>{<br> "message": "Password updated"<br>}                                             | EP-01 |
| **US-IAM-06** | API RESTful – Verificar MFA                        | Como usuario quiero verificar mi método MFA para activarlo.                                  | **Escenario: Verificación MFA**.<br>**Cuando** envío `POST /api/v1/iam/users/{id}/verify-mfa` con<br>`json`<br>{<br> "methodId": "uuid",<br> "code": "123456"<br>}<br>**Entonces** el sistema valida el código y devuelve `200 OK`.                                                                                                                                                                                     | EP-01 |
| **US-IAM-07** | API RESTful – Registrar método MFA para usuario | Como usuario quiero registrar un método de autenticación multifactor para proteger mi cuenta con un segundo factor de seguridad. | **Escenario: Registro de método MFA**.<br>**Dado que** el usuario está autenticado.<br>**Cuando** envío `POST /api/v1/iam/users/{id}/mfa-methods` con<br>`json`<br>{<br> "type": "AUTH_APP",<br> "destination": "user@auth-app"<br>}<br>**Entonces** el sistema registra el método MFA en estado no verificado y devuelve `201 Created` con<br>`json`<br>{<br> "methodId": "uuid",<br> "type": "AUTH_APP",<br> "verified": false<br>} | EP-01 |

#### PROFILES

| ID | Título                     | Descripción                                                         | Criterio de Aceptación                                                                                                                                                     | Relación (Epic ID) |
| ------------------ | -------------------------- | ------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------ |
| **US-PRF-01** | API RESTful – Crear perfil del cliente                | Como usuario autenticado quiero crear mi perfil con mis datos personales para completar mi registro como cliente bancario. | **Escenario: Creación de perfil**.<br>**Cuando** envío `POST /api/v1/profiles` con<br>`json`<br>{<br> "givenNames": "Chester", <br> "paternalSurname": "Bennighton", <br> "maternalSurname": "Charles", <br> "phoneNumber": "+51994755649", <br> "documentType": "DNI", <br> "documentNumber": "40146880" <br>}<br> **Entonces** el sistema crea el perfil asociado al usuario autenticado y devuelve `201 Created` con<br>`json`<br>{<br> "profileId": "uuid",<br> "userId": "uuid",<br> "givenames": "Chester"<br> .... <br>} | EP-02 |
| **US-PRF-02** | API RESTful – Consultar mi perfil                     | Como usuario quiero consultar mi perfil para visualizar mis datos personales registrados.                                  | **Escenario: Consulta de perfil propio**.<br>**Cuando** envío `GET /api/v1/profiles/me`<br>**Entonces** el sistema devuelve `200 OK` con<br>`json`<br>{<br> "profileId": "uuid", "userId"<br> "givenNames": "Juan Pérez",<br> "addresses": [ ... ],<br> "phoneNumber":  ... <br> ... <br>}                                                                                                                                                                   | EP-02 |
| **US-PRF-03** | API RESTful – Consultar perfil por ID                 | Como sistema quiero consultar un perfil por su identificador para validaciones internas o administrativas.                 | **Escenario: Consulta de perfil por ID**.<br>**Cuando** envío `GET /api/v1/profiles/{profileId}`<br>**Entonces** el sistema devuelve `200 OK` con la información del perfil correspondiente.                                                                                                                                                                                                                                               | EP-02 |
| **US-PRF-04** | API RESTful – Actualizar perfil                       | Como usuario quiero actualizar la información de mi perfil para mantener mis datos correctos.                              | **Escenario: Actualización de perfil**.<br>**Cuando** envío `PUT /api/v1/profiles/{profileId}` con<br>`json`<br>{<br> "givenNames": "Juan Pérez Gómez",<br> "phoneNumber": "+51911112222"<br> ... <br>}<br>**Entonces** el sistema actualiza el perfil y devuelve `200 OK` con los datos modificados.                                                                                                                                                 | EP-02 |
| **US-PRF-05** | API RESTful – Registrar dirección                     | Como usuario quiero registrar una dirección en mi perfil para completar mi información personal.                           | **Escenario: Registro de dirección**.<br>**Cuando** envío `POST /api/v1/profiles/{profileId}/addresses` con<br>`json`<br>{<br> "type": "BILLING", <br> "line1": "LIMA", <br> "line2": "LURIN", <br> "city": "LURIN", <br> "region": "LURIN", <br> "country": "PERU", <br> "postalCode": "123123", <br> "makePrimary": true<br>}<br>**Entonces** el sistema registra la dirección y devuelve `201 Created` con<br>`json`<br>{<br> "addressId": "uuid",<br> "primary": false<br>...<br>}| EP-02 |
| **US-PRF-06** | API RESTful – Actualizar dirección                    | Como usuario quiero actualizar una dirección registrada en mi perfil.                                                      | **Escenario: Actualización de dirección**.<br>**Cuando** envío `PUT /api/v1/profiles/{profileId}/addresses/{addressId}` con<br>`json`<br>{<br> "type": "string", <br> "line1": "string", <br> "line2": "string", <br> "city": "string",<br> "region": "string", <br> "country": "string", <br> "postalCode": "string"<br>}<br>**Entonces** el sistema actualiza la dirección y devuelve `200 OK`. | EP-02 |
| **US-PRF-07** | API RESTful – Eliminar dirección                      | Como usuario quiero eliminar una dirección que ya no utilizo.                                                              | **Escenario: Eliminación de dirección**.<br>**Cuando** envío `DELETE /api/v1/profiles/{profileId}/addresses/{addressId}`<br>**Entonces** el sistema elimina la dirección y devuelve `204 No Content`.                                                                                                                                                                                                                                      | EP-02 |
| **US-PRF-08** | API RESTful – Marcar dirección como principal         | Como usuario quiero marcar una dirección como principal para que sea la dirección por defecto de mi perfil.                | **Escenario: Dirección principal**.<br>**Cuando** envío `PUT /api/v1/profiles/{profileId}/addresses/{addressId}/primary`<br>**Entonces** el sistema marca la dirección como principal y devuelve `200 OK`.                                                                                                                                                                                                                                 | EP-02 |
| **US-PRF-09** | API RESTful – Consultar preferencias de notificación  | Como usuario quiero consultar mis preferencias de notificación para saber cómo recibo alertas.                             | **Escenario: Consulta de preferencias**.<br>**Cuando** envío `GET /api/v1/profiles/me/preferences/notifications`<br>**Entonces** el sistema devuelve `200 OK` con<br>`json`<br>{<br> "TRANSFER": ["IN_APP", "EMAIL"],<br> "PAYMENT": ["IN_APP"]<br>}                                                                                                                                                                                       | EP-02 |
| **US-PRF-10** | API RESTful – Actualizar preferencias de notificación | Como usuario quiero actualizar mis preferencias de notificación para personalizar cómo recibo mensajes.                    | **Escenario: Actualización de preferencias**.<br>**Cuando** envío `PUT /api/v1/profiles/me/preferences/notifications` con<br>`json`<br>{<br> "TRANSFER": ["IN_APP"],<br> "PAYMENT": ["IN_APP", "SMS"]<br>}<br>**Entonces** el sistema guarda la configuración y devuelve `200 OK`.                                                                                                                                                         | EP-02 |

#### ACCOUNTS

| Epic/User Story ID | Título                                                    | Descripción / User Story                                                                                           | Escenario (Criterios de Aceptación)                                                                                                                                                                                                                                                                                                                    | Relación (Epic ID) |
| ------------------ | --------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------ |
| **US-ACC-01**      | API RESTful – Apertura de cuenta bancaria                 | Como usuario autenticado quiero abrir una cuenta bancaria para almacenar y gestionar mi dinero dentro del sistema. | **Escenario: Apertura de cuenta**.<br>**Cuando** envío `POST /api/v1/accounts` con<br>`json`<br>{<br> "type": "SAVINGS",<br> "currency": "PEN"<br>}<br>**Entonces** el sistema crea la cuenta y devuelve `201 Created` con<br>`json`<br>{<br> "accountId": "uuid",<br> "accountNumber": "ACC-000001",<br> "status": "ACTIVE",<br> "balance": 0.00<br>} | EP-03              |
| **US-ACC-02**      | API RESTful – Consultar mis cuentas                       | Como usuario quiero consultar todas mis cuentas bancarias para visualizar sus saldos y estados.                    | **Escenario: Listado de cuentas**.<br>**Cuando** envío `GET /api/v1/accounts/my`<br>**Entonces** el sistema devuelve `200 OK` con la lista de cuentas asociadas al usuario autenticado.                                                                                                                                                                | EP-03              |
| **US-ACC-03**      | API RESTful – Consultar cuenta por ID                     | Como usuario quiero consultar el detalle de una cuenta bancaria específica para ver su información.                | **Escenario: Consulta de cuenta por ID**.<br>**Cuando** envío `GET /api/v1/accounts/{accountId}`<br>**Entonces** el sistema devuelve `200 OK` con la información de la cuenta si pertenece al usuario autenticado.                                                                                                                                     | EP-03              |
| **US-ACC-04**      | API RESTful – Consultar cuenta por número                 | Como usuario quiero consultar una cuenta bancaria usando su número de cuenta para validaciones internas.           | **Escenario: Consulta por número de cuenta**.<br>**Cuando** envío `GET /api/v1/accounts/by-number/{accountNumber}`<br>**Entonces** el sistema devuelve `200 OK` con los datos de la cuenta correspondiente.                                                                                                                                            | EP-03              |
| **US-ACC-05**      | API RESTful – Depósito en cuenta                          | Como usuario quiero depositar dinero en mi cuenta bancaria para incrementar mi saldo disponible.                   | **Escenario: Depósito exitoso**.<br>**Cuando** envío `POST /api/v1/accounts/{accountId}/deposit` con<br>`json`<br>{<br> "amount": 500.00<br>}<br>**Entonces** el sistema incrementa el saldo, registra el movimiento en Ledger y devuelve `200 OK`.                                                                                                    | EP-03              |
| **US-ACC-06**      | API RESTful – Retiro de cuenta                            | Como usuario quiero retirar dinero de mi cuenta bancaria para disponer de mis fondos.                              | **Escenario: Retiro exitoso**.<br>**Dado que** la cuenta tiene saldo suficiente y está `ACTIVE`.<br>**Cuando** envío `POST /api/v1/accounts/{accountId}/withdraw` con<br>`json`<br>{<br> "amount": 200.00<br>}<br>**Entonces** el sistema reduce el saldo, registra el movimiento en Ledger y devuelve `200 OK`.                                       | EP-03              |
| **US-ACC-07**      | API RESTful – Bloqueo de operaciones por cuenta congelada | Como sistema quiero impedir operaciones financieras si la cuenta está congelada para mantener la seguridad.        | **Escenario: Cuenta congelada**.<br>**Dado que** la cuenta tiene estado `FROZEN`.<br>**Cuando** el usuario intenta depositar, retirar o transferir.<br>**Entonces** el sistema rechaza la operación con un error de negocio.                                                                                                                           | EP-03              |

#### TRANSFERS

| Epic/User Story ID | Título                                                     | Descripción / User Story                                                                                                  | Escenario (Criterios de Aceptación)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Relación (Epic ID) |
| ------------------ | ---------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------ |
| **US-TRF-01**      | API RESTful – Realizar transferencia interna               | Como usuario quiero transferir dinero desde mi cuenta a otra cuenta interna para enviar fondos de forma segura.           | **Escenario: Transferencia exitosa**.<br>**Dado que** la cuenta origen pertenece al usuario autenticado y tiene saldo suficiente.<br>**Cuando** envío `POST /api/v1/transfers` con<br>`json`<br>{<br> "reference": "trf-2026-0001",<br> "fromAccountId": "uuid",<br> "toAccountId": "uuid",<br> "currency": "PEN",<br> "amount": 150.00<br>}<br>**Entonces** el sistema debita la cuenta origen, acredita la cuenta destino, registra entradas en Ledger y devuelve `201 Created` con<br>`json`<br>{<br> "transferId": "uuid",<br> "status": "COMPLETED",<br> "reference": "trf-2026-0001"<br>} | EP-04              |
| **US-TRF-02**      | API RESTful – Idempotencia por reference                   | Como sistema quiero evitar transferencias duplicadas si el usuario reintenta una operación con la misma reference.        | **Escenario: Reintento de transferencia**.<br>**Dado que** existe una transferencia registrada con la reference `"trf-2026-0001"`.<br>**Cuando** envío nuevamente `POST /api/v1/transfers` con la misma reference.<br>**Entonces** el sistema no vuelve a debitar ni acreditar, y devuelve el resultado previamente registrado.                                                                                                                                                                                                                                                                 | EP-04              |
| **US-TRF-03**      | API RESTful – Transferencia fallida por saldo insuficiente | Como usuario quiero recibir una respuesta clara si intento transferir sin saldo suficiente.                               | **Escenario: Saldo insuficiente**.<br>**Dado que** la cuenta origen no tiene saldo suficiente.<br>**Cuando** envío `POST /api/v1/transfers` con un monto mayor al saldo disponible.<br>**Entonces** el sistema registra la transferencia como `FAILED` y devuelve `201 Created` con<br>`json`<br>{<br> "transferId": "uuid",<br> "status": "FAILED",<br> "failureReason": "Insufficient funds"<br>}                                                                                                                                                                                             | EP-04              |
| **US-TRF-04**      | API RESTful – Consultar transferencia por ID               | Como usuario quiero consultar el detalle de una transferencia para conocer su estado y resultado.                         | **Escenario: Consulta de transferencia**.<br>**Cuando** envío `GET /api/v1/transfers/{transferId}`<br>**Entonces** el sistema devuelve `200 OK` con el detalle de la transferencia si el usuario tiene permisos sobre la cuenta origen.                                                                                                                                                                                                                                                                                                                                                         | EP-04              |
| **US-TRF-05**      | API RESTful – Historial de transferencias por cuenta       | Como usuario quiero listar las transferencias asociadas a una cuenta para revisar mi historial de envíos y recepciones.   | **Escenario: Listado por cuenta**.<br>**Cuando** envío `GET /api/v1/transfers/by-account/{accountId}`<br>**Entonces** el sistema devuelve `200 OK` con la lista de transferencias donde la cuenta participó como origen o destino, validando ownership.                                                                                                                                                                                                                                                                                                                                         | EP-04              |
| **US-TRF-06**      | API RESTful – Bloqueo por límites diarios                  | Como sistema quiero bloquear transferencias si el usuario excede límites diarios de monto o cantidad para prevenir abuso. | **Escenario: Límite excedido**.<br>**Dado que** el usuario ya alcanzó su límite diario de transferencias.<br>**Cuando** intenta crear una nueva transferencia con `POST /api/v1/transfers`.<br>**Entonces** el sistema rechaza la operación registrando el estado `FAILED` con motivo de límite excedido y no mueve fondos.                                                                                                                                                                                                                                                                     | EP-04              |

#### PAYMENTS

| Epic/User Story ID | Título                                              | Descripción / User Story                                                                                                    | Escenario (Criterios de Aceptación)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Relación (Epic ID) |
| ------------------ | --------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------ |
| **US-PAY-01**      | API RESTful – Consultar categorías de servicios     | Como usuario quiero consultar las categorías disponibles de servicios para saber qué tipos de pagos puedo realizar.         | **Escenario: Catálogo de categorías**.<br>**Cuando** envío `GET /api/v1/merchant/categories`<br>**Entonces** el sistema devuelve `200 OK` con la lista de categorías disponibles, por ejemplo `["ELECTRICITY","WATER","INTERNET","UNIVERSITY"]`.                                                                                                                                                                                                                                                                                                                                                                                             | EP-05              |
| **US-PAY-02**      | API RESTful – Consultar empresas por categoría      | Como usuario quiero consultar las empresas disponibles de una categoría para elegir correctamente el merchant de pago.      | **Escenario: Catálogo por categoría**.<br>**Cuando** envío `GET /api/v1/merchant/merchants?category=ELECTRICITY`<br>**Entonces** el sistema devuelve `200 OK` con la lista de merchants de esa categoría, incluyendo `code` y `name`.                                                                                                                                                                                                                                                                                                                                                                                                        | EP-05              |
| **US-PAY-03**      | API RESTful – Realizar pago de servicio exitoso     | Como usuario quiero pagar un servicio (luz/agua/internet/universidad) desde mi cuenta para cumplir una obligación.          | **Escenario: Pago aprobado**.<br>**Dado que** la cuenta pertenece al usuario autenticado y tiene saldo suficiente.<br>**Cuando** envío `POST /api/v1/payments` con<br>`json`<br>{<br> "reference": "pay-2026-0001",<br> "fromAccountId": "uuid",<br> "merchantCode": "ELECTRICITY_ENEL",<br> "type": "SERVICE",<br> "currency": "PEN",<br> "amount": 120.50,<br> "customerRef": "NIS_123456789"<br>}<br>**Entonces** el sistema valida el merchant, debita la cuenta, registra el movimiento en Ledger y devuelve `201 Created` con<br>`json`<br>{<br> "paymentId": "uuid",<br> "status": "COMPLETED",<br> "reference": "pay-2026-0001"<br>} | EP-05              |
| **US-PAY-04**      | API RESTful – Pago fallido por rechazo del merchant | Como usuario quiero recibir una respuesta clara si el proveedor rechaza mi pago para saber el motivo del fallo.             | **Escenario: Pago rechazado**.<br>**Dado que** el merchant rechaza el pago por validación de `customerRef` o reglas internas.<br>**Cuando** envío `POST /api/v1/payments` con un `customerRef` inválido o monto que excede límite del merchant.<br>**Entonces** el sistema devuelve `201 Created` con estado `FAILED` y motivo, por ejemplo<br>`json`<br>{<br> "paymentId": "uuid",<br> "status": "FAILED",<br> "failureReason": "Invalid electricity supply number"<br>}                                                                                                                                                                    | EP-05              |
| **US-PAY-05**      | API RESTful – Idempotencia en pagos por reference   | Como sistema quiero evitar cobros duplicados si el usuario reintenta un pago con la misma reference.                        | **Escenario: Reintento de pago**.<br>**Dado que** existe un pago registrado con `reference = "pay-2026-0001"`.<br>**Cuando** envío nuevamente `POST /api/v1/payments` con la misma reference.<br>**Entonces** el sistema no vuelve a debitar ni registrar ledger duplicado y devuelve el pago previamente registrado.                                                                                                                                                                                                                                                                                                                        | EP-05              |
| **US-PAY-06**      | API RESTful – Consultar pago por reference          | Como usuario quiero consultar un pago por reference para recuperar el resultado de un reintento o seguimiento de operación. | **Escenario: Consulta por reference**.<br>**Cuando** envío `GET /api/v1/payments/by-reference/{reference}`<br>**Entonces** el sistema devuelve `200 OK` con el detalle del pago si el usuario es dueño de la cuenta origen.                                                                                                                                                                                                                                                                                                                                                                                                                  | EP-05              |
| **US-PAY-07**      | API RESTful – Historial de pagos por cuenta         | Como usuario quiero listar los pagos realizados desde una cuenta para revisar mis consumos y servicios pagados.             | **Escenario: Listado por cuenta**.<br>**Cuando** envío `GET /api/v1/payments/by-account/{accountId}`<br>**Entonces** el sistema devuelve `200 OK` con la lista de pagos realizados desde esa cuenta, validando ownership.                                                                                                                                                                                                                                                                                                                                                                                                                    | EP-05              |
| **US-PAY-08**      | API RESTful – Bloqueo por límites diarios en pagos  | Como sistema quiero bloquear pagos si el usuario excede límites diarios de monto o cantidad para prevenir abuso.            | **Escenario: Límite excedido**.<br>**Dado que** el usuario alcanzó su límite diario de pagos.<br>**Cuando** intenta crear un pago con `POST /api/v1/payments`.<br>**Entonces** el sistema registra el pago como `FAILED`, no debita fondos y devuelve el motivo asociado al límite excedido.                                                                                                                                                                                                                                                                                                                                                 | EP-05              |

#### LEDGER


| Epic/User Story ID | Título                                            | Descripción / User Story                                                                                                                                  | Escenario (Criterios de Aceptación)                                                                                                                                                                                                                                                                                                                                                                                                        | Relación (Epic ID) |
| ------------------ | ------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------ |
| **US-LED-01**      | API RESTful – Consultar movimientos por cuenta    | Como usuario quiero consultar los movimientos contables de una cuenta para revisar el historial real de entradas y salidas de dinero.                     | **Escenario: Consulta de ledger por cuenta**.<br>**Dado que** la cuenta pertenece al usuario autenticado.<br>**Cuando** envío `GET /api/v1/ledger/by-account/{accountId}`<br>**Entonces** el sistema devuelve `200 OK` con la lista de entradas del ledger asociadas a esa cuenta, incluyendo `type` (DEBIT/CREDIT), `source` (TRANSFER/PAYMENT/DEPOSIT/WITHDRAW), `amount`, `currency`, `reference` y `createdAt`.                        | EP-06              |
| **US-LED-02**      | API RESTful – Consultar movimientos por reference | Como usuario quiero consultar las entradas contables asociadas a una misma reference para rastrear una operación completa, como una transferencia o pago. | **Escenario: Consulta de ledger por reference**.<br>**Dado que** la reference corresponde a una operación registrada (por ejemplo una transferencia).<br>**Cuando** envío `GET /api/v1/ledger/by-reference/{reference}`<br>**Entonces** el sistema devuelve `200 OK` con todas las entradas contables correlacionadas a esa reference, típicamente un DEBIT y un CREDIT en el caso de una transferencia, o un DEBIT en el caso de un pago. | EP-06              |
| **US-LED-03**      | API RESTful – Control de acceso al ledger         | Como sistema quiero impedir que un usuario consulte movimientos contables de cuentas ajenas para mantener confidencialidad bancaria.                      | **Escenario: Bloqueo por ownership**.<br>**Dado que** el usuario autenticado no es dueño de la cuenta asociada al ledger.<br>**Cuando** intenta consumir `GET /api/v1/ledger/by-account/{accountId}` o `GET /api/v1/ledger/by-reference/{reference}`.<br>**Entonces** el sistema devuelve `403 Forbidden` y no expone información contable.                                                                                                | EP-06              |

#### STATEMENTS / REPORTS

| Epic/User Story ID | Título                                                     | Descripción / User Story                                                                                                           | Escenario (Criterios de Aceptación)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Relación (Epic ID) |
| ------------------ | ---------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------ |
| **US-REP-01**      | API RESTful – Generar estado de cuenta (JSON) por periodo  | Como usuario quiero generar el estado de cuenta de una cuenta en un rango de fechas para revisar saldos y movimientos del periodo. | **Escenario: Estado de cuenta por periodo**.<br>**Dado que** la cuenta pertenece al usuario autenticado.<br>**Cuando** envío `GET /api/v1/statements/by-account/{accountId}?from=2026-01-01&to=2026-01-31`<br>**Entonces** el sistema devuelve `200 OK` con<br>`json`<br>{<br> "accountId": "uuid",<br> "from": "2026-01-01",<br> "to": "2026-01-31",<br> "openingBalance": 100.00,<br> "totalCredits": 500.00,<br> "totalDebits": 200.00,<br> "closingBalance": 400.00,<br> "lines": [ ... ]<br>}<br>y calcula el opening balance usando el acumulado anterior del Ledger. | EP-07              |
| **US-REP-02**      | API RESTful – Descargar estado de cuenta (PDF) por periodo | Como usuario quiero descargar un estado de cuenta en PDF para conservarlo como documento bancario formal.                          | **Escenario: PDF por periodo**.<br>**Dado que** la cuenta pertenece al usuario autenticado.<br>**Cuando** envío `GET /api/v1/statements/by-account/{accountId}/pdf?from=2026-01-01&to=2026-01-31`<br>**Entonces** el sistema devuelve `200 OK` con `Content-Type: application/pdf` y un archivo PDF que incluye resumen (opening/credits/debits/closing) y detalle de movimientos del periodo.                                                                                                                                                                              | EP-07              |
| **US-REP-03**      | API RESTful – Descargar estado de cuenta (PDF) completo    | Como usuario quiero descargar el historial completo en PDF para auditoría personal o evidencia de movimientos.                     | **Escenario: PDF all-time**.<br>**Dado que** la cuenta pertenece al usuario autenticado.<br>**Cuando** envío `GET /api/v1/statements/by-account/{accountId}/pdf/all`<br>**Entonces** el sistema devuelve `200 OK` con `Content-Type: application/pdf` y un PDF que contiene todos los movimientos históricos registrados en el Ledger para esa cuenta.                                                                                                                                                                                                                      | EP-07              |
| **US-REP-04**      | API RESTful – Control de acceso a reportes                 | Como sistema quiero impedir que un usuario genere reportes de cuentas ajenas para mantener confidencialidad bancaria.              | **Escenario: Bloqueo por ownership**.<br>**Dado que** el usuario no es dueño de la cuenta solicitada.<br>**Cuando** intenta consumir cualquiera de los endpoints `/statements/by-account/{accountId}`.<br>**Entonces** el sistema devuelve `403 Forbidden` y no genera el reporte.                                                                                                                                                                                                                                                                                          | EP-07              |

#### NOTIFICATIONS

| Epic/User Story ID | Título                                               | Descripción / User Story                                                                                                                   | Escenario (Criterios de Aceptación)                                                                                                                                                                                                                                                                                                           | Relación (Epic ID) |
| ------------------ | ---------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------ |
| **US-NOT-01**      | API RESTful – Consultar mis notificaciones           | Como usuario quiero consultar mis notificaciones para estar informado sobre operaciones y eventos relevantes del sistema bancario.         | **Escenario: Listado de notificaciones**.<br>**Cuando** envío `GET /api/v1/notifications/my`<br>**Entonces** el sistema devuelve `200 OK` con una lista de notificaciones del usuario autenticado, incluyendo `type`, `channel`, `title`, `body`, `status`, `reference` y `createdAt`.                                                        | EP-08              |
| **US-NOT-02**      | API RESTful – Marcar notificación como leída         | Como usuario quiero marcar una notificación como leída para gestionar mi bandeja y distinguir alertas pendientes.                          | **Escenario: Marcar como READ**.<br>**Dado que** la notificación pertenece al usuario autenticado.<br>**Cuando** envío `PUT /api/v1/notifications/{id}/read`<br>**Entonces** el sistema cambia el estado a `READ` y devuelve `200 OK` con la notificación actualizada.                                                                        | EP-08              |
| **US-NOT-03**      | API RESTful – Archivar una notificación              | Como usuario quiero archivar una notificación para limpiar mi bandeja principal sin eliminar el historial.                                 | **Escenario: Marcar como ARCHIVED**.<br>**Dado que** la notificación pertenece al usuario autenticado.<br>**Cuando** envío `PUT /api/v1/notifications/{id}/archive`<br>**Entonces** el sistema cambia el estado a `ARCHIVED` y devuelve `200 OK` con la notificación actualizada.                                                             | EP-08              |
| **US-NOT-04**      | API RESTful – Notificaciones automáticas por eventos | Como usuario quiero recibir notificaciones automáticas cuando realizo operaciones bancarias para mantener trazabilidad y control personal. | **Escenario: Notificación por transferencia/pago**.<br>**Dado que** ocurre una operación relevante (transferencia, pago, depósito o retiro).<br>**Cuando** el sistema completa la operación.<br>**Entonces** se registra una notificación in-app y, si el usuario lo configuró, se envía también por email/SMS según preferencias del perfil. | EP-08              |
| **US-NOT-05**      | API RESTful – Control de acceso a notificaciones     | Como sistema quiero impedir que un usuario vea o modifique notificaciones ajenas para garantizar privacidad.                               | **Escenario: Bloqueo por ownership**.<br>**Dado que** una notificación no pertenece al usuario autenticado.<br>**Cuando** intenta `PUT /notifications/{id}/read` o `PUT /notifications/{id}/archive`.<br>**Entonces** el sistema devuelve `403 Forbidden`.                                                                                    | EP-08              |

#### LIMITS

| Epic/User Story ID | Título                                           | Descripción / User Story                                                                                                               | Escenario (Criterios de Aceptación)                                                                                                                                                                                                                                                                                                                                                                           | Relación (Epic ID) |
| ------------------ | ------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------ |
| **US-LIM-01**      | Regla de negocio – Bloquear por monto diario     | Como sistema quiero bloquear una operación si el usuario excede el monto máximo diario permitido para prevenir abuso.                  | **Escenario: Monto diario excedido**.<br>**Dado que** el usuario ya consumió parte del límite diario de una operación (TRANSFER o PAYMENT).<br>**Cuando** intenta ejecutar una nueva operación que hace que `usedAmount + amount > maxDailyAmount`.<br>**Entonces** el sistema rechaza la operación (no debita fondos, no registra ledger) y la marca como `FAILED` con motivo “Daily amount limit exceeded”. | EP-09              |
| **US-LIM-02**      | Regla de negocio – Bloquear por cantidad diaria  | Como sistema quiero bloquear una operación si el usuario excede la cantidad máxima diaria permitida para evitar transacciones masivas. | **Escenario: Cantidad diaria excedida**.<br>**Dado que** el usuario ya alcanzó `usedCount` del día para una operación.<br>**Cuando** intenta ejecutar una operación adicional que hace `usedCount + 1 > maxDailyCount`.<br>**Entonces** el sistema rechaza la operación y registra el motivo “Daily operation count limit exceeded”.                                                                          | EP-09              |
| **US-LIM-03**      | Regla de negocio – Consumo de límite al permitir | Como sistema quiero registrar el consumo del límite cuando una operación es permitida para mantener control diario consistente.        | **Escenario: Consumo exitoso**.<br>**Dado que** una operación está dentro de los límites.<br>**Cuando** se autoriza la operación.<br>**Entonces** el sistema actualiza `limit_usages` incrementando `usedAmount` y `usedCount` para el día actual (UTC) y permite continuar con el flujo (debit/ledger).                                                                                                      | EP-09              |
| **US-LIM-04**      | Regla de negocio – Reinicio automático diario    | Como sistema quiero reiniciar los límites de forma automática al cambiar de día para restaurar la capacidad operativa del usuario.     | **Escenario: Nuevo día**.<br>**Dado que** el día cambia (UTC) y no existe un registro de uso para el nuevo periodo.<br>**Cuando** el usuario realiza su primera operación del día.<br>**Entonces** el sistema crea un nuevo registro en `limit_usages` con consumo inicial en cero y evalúa límites desde ese punto.                                                                                          | EP-09              |



#### ADMIN / COMPILANCE

| Epic/User Story ID | Título                                         | Descripción / User Story                                                                                              | Escenario (Criterios de Aceptación)                                                                                                                                                                                                                                                                                                                                 | Relación (Epic ID) |
| ------------------ | ---------------------------------------------- | --------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------ |
| **US-ADM-01**      | API RESTful – Congelar cuenta (admin)          | Como administrador quiero congelar una cuenta para bloquear operaciones por seguridad/compliance.                     | **Escenario: Congelar cuenta**.<br>**Cuando** envío `PUT /api/v1/admin/accounts/{accountId}/freeze` con<br>`json`<br>{<br> "reason": "Suspicious activity"<br>}<br>**Entonces** el sistema cambia el estado de la cuenta a `FROZEN`, registra auditoría y devuelve `200 OK`.                                                                                        | EP-10              |
| **US-ADM-02**      | API RESTful – Descongelar cuenta (admin)       | Como administrador quiero desbloquear una cuenta para restaurar operaciones cuando se resuelve el incidente.          | **Escenario: Descongelar cuenta**.<br>**Cuando** envío `PUT /api/v1/admin/accounts/{accountId}/unfreeze` con<br>`json`<br>{<br> "reason": "Issue resolved"<br>}<br>**Entonces** el sistema cambia el estado a `ACTIVE`, registra auditoría y devuelve `200 OK`.                                                                                                     | EP-10              |
| **US-ADM-03**      | API RESTful – Cerrar cuenta (admin)            | Como administrador quiero cerrar una cuenta para inhabilitarla permanentemente según política o solicitud formal.     | **Escenario: Cierre de cuenta**.<br>**Dado que** la cuenta tiene saldo 0.<br>**Cuando** envío `PUT /api/v1/admin/accounts/{accountId}/close` con<br>`json`<br>{<br> "reason": "Customer request"<br>}<br>**Entonces** el sistema cambia el estado a `CLOSED`, registra auditoría y devuelve `200 OK`.                                                               | EP-10              |
| **US-ADM-04**      | API RESTful – Resetear límites del día (admin) | Como administrador quiero resetear los límites diarios de un usuario para permitirle operar nuevamente por excepción. | **Escenario: Reset de límites diarios**.<br>**Cuando** envío `DELETE /api/v1/admin/limits/{userId}/today`<br>**Entonces** el sistema elimina el uso del día actual (UTC) en `limit_usages` para ese usuario y devuelve `200 OK` indicando cuántos registros fueron reseteados.                                                                                      | EP-10              |
| **US-ADM-05**      | API RESTful – Override de límites (admin)      | Como administrador quiero aumentar límites diarios de un usuario para clientes verificados o premium.                 | **Escenario: Upsert de override**.<br>**Cuando** envío `PUT /api/v1/admin/limits/{userId}/override` con<br>`json`<br>{<br> "operationType": "TRANSFER",<br> "maxDailyAmount": 20000.00,<br> "maxDailyCount": 50,<br> "reason": "KYC VERIFIED"<br>}<br>**Entonces** el sistema guarda el override, registra auditoría y devuelve `200 OK` con los valores aplicados. | EP-10              |
| **US-ADM-06**      | API RESTful – Dashboard: auditoría de acciones | Como administrador quiero consultar las acciones administrativas para monitoreo y trazabilidad.                       | **Escenario: Consulta de acciones admin**.<br>**Cuando** envío `GET /api/v1/admin/actions?page=0&size=20&actionType=FREEZE_ACCOUNT`<br>**Entonces** el sistema devuelve `200 OK` con una lista paginada de auditoría, incluyendo adminUserId, actionType, targetId, reason y fecha.                                                                                 | EP-10              |
| **US-ADM-07**      | API RESTful – Dashboard: cuentas congeladas    | Como administrador quiero listar cuentas congeladas para supervisión y control de riesgo.                             | **Escenario: Listar cuentas frozen**.<br>**Cuando** envío `GET /api/v1/admin/accounts/frozen`<br>**Entonces** el sistema devuelve `200 OK` con la lista de cuentas en estado `FROZEN`, incluyendo ownerId, balance y currency.                                                                                                                                      | EP-10              |

